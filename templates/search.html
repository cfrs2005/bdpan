{% extends "base.html" %}

{% block title %}
网盘搜索转存 - 首页
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- 页面标题 -->
        <div class="text-center mb-5">
            <h1 class="display-4 mb-3">
                <i class="fas fa-cloud-download-alt text-primary"></i>
                网盘搜索转存系统
            </h1>
            <p class="lead text-muted">
                快速搜索电影电视剧资源，智能转存到百度网盘
            </p>
        </div>

        <!-- 搜索表单 -->
        <div class="search-form">
            <form id="search-form">
                <div class="mb-3">
                    <label for="search-keyword" class="form-label fw-bold">
                        <i class="fas fa-search"></i> 输入影视名称
                    </label>
                    <input type="text" 
                           class="form-control search-input" 
                           id="search-keyword" 
                           name="keyword"
                           placeholder="例如：流浪地球2、庆余年2、三体..."
                           required>
                    <div class="form-text">
                        支持中文/英文名称搜索，请输入完整的影视名称获取更准确的结果
                    </div>
                </div>
                
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary search-btn" id="search-btn">
                        <i class="fas fa-search"></i>
                        <span class="btn-text">立即搜索并转存</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- 热门推荐 -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="fas fa-tags"></i> 热门搜索</span>
                <button class="btn btn-outline-secondary btn-sm" onclick="loadRecommendations()">
                    <i class="fas fa-sync"></i> 刷新推荐
                </button>
            </div>
            <div class="card-body">
                <div id="recommendations-container">
                    <!-- 默认推荐，将被动态替换 -->
                    <div class="row">
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card recommendation-card h-100" data-search="实习医生格蕾">
                                <div class="recommendation-poster-container">
                                    <img src="https://image.tmdb.org/t/p/w300/yH40xfaBI60J8WptdGyuhebyHhH.jpg" class="recommendation-poster" alt="实习医生格蕾" onerror="this.style.display='none'">
                                    <div class="recommendation-overlay">
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-search"></i> 搜索
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-2 text-center">实习医生格蕾</h6>
                                    <div class="text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-tv"></i> 电视剧 · 2005
                                        </small>
                                        <div class="mt-1"><span class="badge bg-warning text-dark">8.2</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card recommendation-card h-100" data-search="Victoria">
                                <div class="recommendation-poster-container">
                                    <img src="https://image.tmdb.org/t/p/w300/aOSTW7ZitFAff06mZVXUnktejHY.jpg" class="recommendation-poster" alt="Victoria" onerror="this.style.display='none'">
                                    <div class="recommendation-overlay">
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-search"></i> 搜索
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-2 text-center">Victoria</h6>
                                    <div class="text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-film"></i> 电影 · 2021
                                        </small>
                                        <div class="mt-1"><span class="badge bg-warning text-dark">6.3</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card recommendation-card h-100" data-search="钢之炼金术师 FA">
                                <div class="recommendation-poster-container">
                                    <img src="https://image.tmdb.org/t/p/w300/dLIAaTiNN8XnUwSh9HW4FNNtEcQ.jpg" class="recommendation-poster" alt="钢之炼金术师 FA" onerror="this.style.display='none'">
                                    <div class="recommendation-overlay">
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-search"></i> 搜索
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-2 text-center">钢之炼金术师 FA</h6>
                                    <div class="text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-tv"></i> 电视剧 · 2009
                                        </small>
                                        <div class="mt-1"><span class="badge bg-warning text-dark">8.7</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card recommendation-card h-100" data-search="梅根2.0">
                                <div class="recommendation-poster-container">
                                    <img src="https://image.tmdb.org/t/p/w300/lQXDRQUxfkoABXh03eadAr1C8H7.jpg" class="recommendation-poster" alt="梅根2.0" onerror="this.style.display='none'">
                                    <div class="recommendation-overlay">
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-search"></i> 搜索
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-2 text-center">梅根2.0</h6>
                                    <div class="text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-film"></i> 电影 · 2025
                                        </small>
                                        <div class="mt-1"><span class="badge bg-warning text-dark">7.5</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card recommendation-card h-100" data-search="肖申克的救赎">
                                <div class="recommendation-poster-container">
                                    <img src="https://image.tmdb.org/t/p/w300/aAdnwqwkKX5PPcr8EdtaiA8AZVl.jpg" class="recommendation-poster" alt="肖申克的救赎" onerror="this.style.display='none'">
                                    <div class="recommendation-overlay">
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-search"></i> 搜索
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-2 text-center">肖申克的救赎</h6>
                                    <div class="text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-film"></i> 电影 · 1994
                                        </small>
                                        <div class="mt-1"><span class="badge bg-warning text-dark">8.7</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card recommendation-card h-100" data-search="奇迹少女">
                                <div class="recommendation-poster-container">
                                    <img src="https://image.tmdb.org/t/p/w300/wpHrxkJzXJAFOeNUh2phKdxdJ6L.jpg" class="recommendation-poster" alt="奇迹少女" onerror="this.style.display='none'">
                                    <div class="recommendation-overlay">
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-search"></i> 搜索
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-2 text-center">奇迹少女</h6>
                                    <div class="text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-tv"></i> 电视剧 · 2015
                                        </small>
                                        <div class="mt-1"><span class="badge bg-warning text-dark">8.0</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card recommendation-card h-100" data-search="绝命毒师">
                                <div class="recommendation-poster-container">
                                    <img src="https://image.tmdb.org/t/p/w300/bSldznJEjkeojc5dzjLvlukqVEU.jpg" class="recommendation-poster" alt="绝命毒师" onerror="this.style.display='none'">
                                    <div class="recommendation-overlay">
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-search"></i> 搜索
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-2 text-center">绝命毒师</h6>
                                    <div class="text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-tv"></i> 电视剧 · 2008
                                        </small>
                                        <div class="mt-1"><span class="badge bg-warning text-dark">8.9</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card recommendation-card h-100" data-search="喜羊羊与灰太狼之异国破晓">
                                <div class="recommendation-poster-container">
                                    <img src="https://image.tmdb.org/t/p/w300/tvooHfa3uBh89NNpJKb96ntNoRl.jpg" class="recommendation-poster" alt="喜羊羊与灰太狼之异国破晓" onerror="this.style.display='none'">
                                    <div class="recommendation-overlay">
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-search"></i> 搜索
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-2 text-center">喜羊羊与灰太狼之异国破晓</h6>
                                    <div class="text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-film"></i> 电影 · 2025
                                        </small>
                                        <div class="mt-1"><span class="badge bg-warning text-dark">8.5</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-muted small mt-2">
                    <i class="fas fa-info-circle"></i> 推荐内容来自TMDb API，每次刷新获取最新热门影视
                </div>
            </div>
        </div>

        <!-- 系统提示 -->
        <div class="alert alert-info">
            <div class="d-flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-info-circle fa-2x"></i>
                </div>
                <div class="flex-grow-1 ms-3">
                    <h5 class="alert-heading">使用说明</h5>
                    <ul class="mb-0">
                        <li>输入完整的影视名称（如"流浪地球2"而不是"流浪"）</li>
                        <li>系统将自动识别是电影还是电视剧</li>
                        <li>资源会自动转存到相应目录：电影→/我的资源/2025/电影，电视剧→/我的资源/2025/电视剧</li>
                        <li>搜索过程可能需要30秒左右，请耐心等待</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 搜索结果区域 -->
        <div id="search-results"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// 页面特定脚本
$(document).ready(function() {
    // 焦点到搜索框
    $('#search-keyword').focus();
    
    // 检查URL参数中是否有搜索关键词
    const urlParams = new URLSearchParams(window.location.search);
    const keyword = urlParams.get('keyword');
    const autoSearch = urlParams.get('auto_search') === 'true';
    
    if (keyword) {
        $('#search-keyword').val(keyword);
        if (autoSearch) {
            // 延迟执行搜索，确保页面完全加载
            setTimeout(() => {
                $('#search-form').submit();
            }, 500);
        }
    }
    
    // 搜索框回车键监听
    $('#search-keyword').on('keypress', function(e) {
        if (e.which === 13) {
            $('#search-form').submit();
        }
    });
    
    // 搜索输入提示
    $('#search-keyword').autocomplete({
        source: function(request, response) {
            const history = getSearchHistory();
            const keywords = history.map(item => item.keyword)
                .filter(keyword => keyword.toLowerCase().includes(request.term.toLowerCase()))
                .slice(0, 5);
            response(keywords);
        }
    });
});

// 即时搜索（可选功能）
let searchTimeout;
$('#search-keyword').on('input', function() {
    clearTimeout(searchTimeout);
    const keyword = $(this).val();
    
    if (keyword.length < 2) {
        $('#instant-results').hide();
        return;
    }
    
    searchTimeout = setTimeout(() => {
        // 这里可以实现即时搜索功能
        // performInstantSearch(keyword);
    }, 500);
});
</script>

<!-- jQuery UI 自动完成 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/ui-lightness/jquery-ui.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
{% endblock %}